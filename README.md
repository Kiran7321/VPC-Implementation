# VPC implementation in a production like environment

1. The below diagram from AWS represents the desired VPC creation in organisations. This project mainly focuses on implementing this logic. A simple html pages will be hosted on the EC2 instances which are in private subnets span over 2 AZ's. The VPC will be created in a way such that 2 public subnets and 2 private subnets will be formed overr 2 AZ's


   ![image](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/212759ae-9278-4a49-90d2-2b17867440a7)


2. These EC2 instances are maintained using a auto scaling group to show what happens when high no. of requests are sent to the load balancers which are in the public subnets of the VPC i.e., ASG will adjust the no. of instances required based on the current scenario. The users will send their requests to the load balancers in public subnets in order to access the instaces hosted in private subnets. And the EC2 instances will use the NAT (Network Address Translation) Gateways to talk to the internet.

3. In order to host applications on the private EC2 instances, we obviously need to ssh into them. However we can not directly ssh as they're literally in private subnets to increase the security and reduce the vulnerability. So, to overcome this issue, we'll create something called Jump Server/Bastion Host that acts as an intermediatery between the load balancers in the public group and the instances in the private group.

4. To ssh from the Bastion host to the private instance, we need to have the .pem login file for the private instance stored in Bastion Host. To do that, we first need to securely copy that .pem file from our own machine to the Bastion Host using the SCP command in Linux. 

5. And to demonstrate the purpose of Load Balancer, we'll host to different html pages on the 2 hosts. So that LB will direct to one of them when multiple requests are made i.e., getting two different responces for same requests made by users.

6. Search VPC in the AWS console < Create VPC < Modify the settings as below. You can see the diagram generated by AWS showing how the subnets are created in my vpc. If you select vpc only while creating a VPC, you need to manually create these subnets and assign the IP ranges for them all by yourself. To simplify this, I selected vpc and more where AWS will take care of all that work for me.

![image](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/4096a8dc-5278-4406-90d1-fb4b578dcbb2)
![image](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/1c324abc-b751-4fa0-9c88-7df95d305bcb)

7. Once the Vpc is created, it may take some time based upon the resources used in your AWS account. And it takes few minutes to reflect the change. So, please be patient like the tortaise ;)

![Screenshot 2024-02-28 at 7 58 24 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/39f2b86a-c0af-4fc9-973c-a859cf0474eb)

8. Now, we will create the ASG. Search for EC2 in console and then go to ASG from there. In order to create an ASG, one has to use a Launch template which is why we will create a launch template that will be used for the creation of ASG. A launch template generally describes how/when the scaling should take place. Follow the bellow configurations to create a launch template and once created use it in the ASG.

![Screenshot 2024-02-28 at 8 10 15 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/32187194-2b34-4783-aed8-66d22738a21b)
![Screenshot 2024-02-28 at 8 10 36 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/1dd1af18-3708-47a5-8aa5-07d62fe970b8)
![Screenshot 2024-02-28 at 8 11 18 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/fe25e52d-b1e2-48c5-baae-5ad64e1aee64)
![Screenshot 2024-02-28 at 8 11 59 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/a2570a5f-9dbc-4381-a6b2-bbfa53424058)

9. Assuming that the template is created, below image shows how to configure the ASG using the template created. Vpc should be selected as the one that we created for this project and subnets needs to be selected as private subnets. Do not attach the LB now, we'll come to that step later.

![Screenshot 2024-02-28 at 8 13 24 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/856abd8d-95aa-4cd3-8157-6cd3e27668d7)
![Screenshot 2024-02-28 at 8 15 08 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/05960887-6624-40f4-86f3-2ae7b7518fef)
![Screenshot 2024-02-28 at 8 16 12 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/55bd12b9-ac9f-4e30-a13f-32b06b9ecc47)
![Screenshot 2024-02-28 at 8 17 23 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/f424c0cd-1508-46e5-8ef1-e9fcb3fc202f)

10. Once the ASG is created, 2 EC2 instances because the desired capacity is set to to 2 instances, will be created which you can see by going to EC2 dashboard < instances

![Screenshot 2024-02-28 at 8 23 31 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/5fa9ee52-4519-4d4c-ad8b-8f456878021a)


11. Since these instances won't have any public IP's, we wi;; create a Jump Srever in the public subnets from which we'll access these instances to host our applications.

![Screenshot 2024-02-28 at 8 32 07 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/62408130-e857-4fc2-9653-a045b98d0a29)
![Screenshot 2024-02-28 at 8 32 35 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/d1197e5c-7570-4103-96a2-6b7097090de3)
![Screenshot 2024-02-28 at 8 32 58 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/5363b18c-4ecf-4ae4-a539-7a0427cc784f)

12. To ssh into the Bastion Host, you need to copy it's public address. To ssh, you can directly use your terminal if you're a Mac user. If you're using windows, you can install either putty or mobaxterm.
13. So the order we follw is, ssh from my personal PC to Bastion Host < SSH from Bastion Host to ASG's EC2 instances in private subnets. 
14. To do this we need to copy the .pem file from my personla PC to Bastion Host using secure copy, SCP command

``` bash
scp -i /Users/saikirankommineni/Desktop/aws_login.pem [indicates identity file]  /Users/saikirankommineni/Desktop/aws_login.pem [copy the .pem file from location] ubuntu@13.212.154.125:/home/ubantu [to location]

```

![Screenshot 2024-02-28 at 8 59 58 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/62ce19b5-4591-4ea1-b7c5-ac0d7e6d329b)

15. Once that is done, we'll now ssh into Bastion and from which ssh into each of private instaces. I'm already in the folder where .pem file is present, that's why I just gave the file name instead of whole path. And the user is ubuntu by default as we selected ubuntu image while creating these instances.

``` bash
ssh -i path to .pem file user@public ip of bastion.user
ssh -i path to .pem file user@private ip of EC2 instance in ASG
```

![Screenshot 2024-02-28 at 9 01 48 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/47e1c88f-3d1c-42be-ae08-86a79f979833)
![Screenshot 2024-02-28 at 9 04 09 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/e1686fb4-bd07-48d7-858e-ea0c41447c2e)

16. Once you ssh into the one of the private instances, create an index.html file using the command vim index.html 
17. Copy and paste the below code

``` html <!DOCTYPE html>
<html lang="en">
<head>
<title>Page Title</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, Helvetica, sans-serif;
}
</style>
</head>
<body>

<h1>VPC Implementation </h1>
<p>ap-southeast-1</p> 
```
18. then press esc and then type :wq! to save and exit from Vim

![Screenshot 2024-02-28 at 9 12 54 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/03b3e0ac-0746-4ee2-9921-436154add003)


17. Now we need to run this page/application on this instance. For that, use the command

``` python3
python3 -m http.server 8000

```

![Screenshot 2024-02-28 at 9 23 24 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/655ae789-c054-498b-8830-387d313b2878)


18. Now we need to create the Load Balancer, so that when we send a request to this LB which in turn talks to ASG and finally show us the application. We're using the application load balancer for this scenario. To do this go to EC2 via console < go to Load Balancers < Create a Load Balancer < Then follow the below configurations

![Screenshot 2024-02-28 at 9 27 24 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/4ffebd52-adf4-421e-bd96-04c9d248dc16)
![Screenshot 2024-02-28 at 9 28 22 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/c5461113-5632-4467-a645-0d7e074fc4ba)
![Screenshot 2024-02-28 at 9 29 42 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/9d0a3510-ec2d-40a5-b98a-99f6a5ebd37d)

19. We need to create a Target Group in order to create the Load Balancer. Open the Create Target Group in a new tab < Follow below configurations

![Screenshot 2024-02-28 at 9 39 34 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/73367deb-c9a4-4a37-a26c-50d8a71c4dc3)
![Screenshot 2024-02-28 at 9 39 58 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/16b6713f-e6f3-48cd-83e7-f4c2c9077661)
![Screenshot 2024-02-28 at 9 40 34 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/d6eede89-cce4-4b4c-a906-8442500d7d0b)

20. Now select the created target group and then click on the Create Load Balancer.
![Screenshot 2024-02-28 at 9 43 30 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/466a66d0-c783-4b1f-8c96-47b1bd536154)


21. We are getting the below error saying that we can't access port 80 after the LB is created. This means that you can't access the application yet using the LB's DNS. So we just need to adjust the inbound rules in Security Group of LB. To do this Go to Security < Click on Security Group Id < Edit Inbound Rule < Add new Rule < Allow http on port 80 from anywhere

![Screenshot 2024-02-28 at 9 45 47 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/130da189-6dd2-4ec1-a773-1cbb1e9c453a)
![Screenshot 2024-02-28 at 9 51 47 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/86e0ae64-5bf1-4af3-9d2d-833f92d56eb6)

22. Once, that is done copy the DNS of LB & paste it in a browser.

![Screenshot 2024-02-28 at 9 56 56 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/119e5092-4063-4a6e-ad75-82bacafc6dc9)

23. As you can see below, the we're now able to see the page hosted on one of the EC2 instances in the private subnet of the VPC.

![Screenshot 2024-02-28 at 9 58 05 PM](https://github.com/Kiran7321/VPC-Implementation/assets/89258260/502d9320-fb7b-4052-bfd0-afd15515eb80)

24. You could host another page on the 2nd Ec2 instance and then try accessing the LB. You will get different pages on same requests over the time. Give it a go ;)
